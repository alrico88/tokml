function c(e,r){let t={">":"&gt;","<":"&lt;","'":"&apos;",'"':"&quot;","&":"&amp;"};var o;if(e!=null)return r=(r||"").replace(/[^&"<>\']/g,""),o=`([&"<>'])`.replace(new RegExp("["+r+"]","g"),""),e.replace(new RegExp(o,"g"),function(u,i){return t[i]})}function w(e){return Object.keys(e).length?" "+Object.keys(e).map(function(r){return r+'="'+c(e[r])+'"'}).join(" "):""}function n(e,r,t){return(Array.isArray(r)||typeof r=="string")&&(t=r,r={}),Array.isArray(t)&&(t=`
`+t.map(function(o){return"  "+o}).join(`
`)+`
`),"<"+e+w(r)+">"+t+"</"+e+">"}function l(e){return e.map(function(r){return r.join(",")}).join(" ")}var a={Point:function(e){return n("Point",n("coordinates",e.coordinates.join(",")))},LineString:function(e){return n("LineString",n("coordinates",l(e.coordinates)))},Polygon:function(e){if(!e.coordinates.length)return"";var r=e.coordinates[0],t=e.coordinates.slice(1),o=n("outerBoundaryIs",n("LinearRing",n("coordinates",l(r)))),u=t.map(function(i){return n("innerBoundaryIs",n("LinearRing",n("coordinates",l(i))))}).join("");return n("Polygon",o+u)},MultiPoint:function(e){return e.coordinates.length?n("MultiGeometry",e.coordinates.map(function(r){return a.Point({coordinates:r})}).join("")):""},MultiPolygon:function(e){return e.coordinates.length?n("MultiGeometry",e.coordinates.map(function(r){return a.Polygon({coordinates:r})}).join("")):""},MultiLineString:function(e){return e.coordinates.length?n("MultiGeometry",e.coordinates.map(function(r){return a.LineString({coordinates:r})}).join("")):""},GeometryCollection:function(e){return n("MultiGeometry",e.geometries.map(a.any).join(""))},valid:function(e){return e&&e.type&&(e.coordinates||e.type==="GeometryCollection"&&e.geometries&&e.geometries.every(a.valid))},any:function(e){return a[e.type]?a[e.type](e):""},isPoint:function(e){return e.type==="Point"||e.type==="MultiPoint"},isPolygon:function(e){return e.type==="Polygon"||e.type==="MultiPolygon"},isLine:function(e){return e.type==="LineString"||e.type==="MultiLineString"}};function s(e,r){if(typeof e!="string")return"";if(e=e.replace("#","").toLowerCase(),e.length===3)e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2];else if(e.length!==6)return"";var t=e[0]+e[1],o=e[2]+e[3],u=e[4]+e[5],i="ff";return typeof r=="number"&&r>=0&&r<=1&&(i=(r*255).toString(16),i.indexOf(".")>-1&&(i=i.substr(0,i.indexOf("."))),i.length<2&&(i="0"+i)),i+u+o+t}function d(e){return!!(e["marker-size"]||e["marker-symbol"]||e["marker-color"])}function y(e){delete e["marker-size"],delete e["marker-symbol"],delete e["marker-color"],delete e["marker-shape"]}var M=n("hotSpot",{xunits:"fraction",yunits:"fraction",x:"0.5",y:"0.5"},"");function j(e,r){var t=r["marker-size"]||"medium",o=r["marker-symbol"]?"-"+r["marker-symbol"]:"",u=(r["marker-color"]||"7e7e7e").replace("#","");return e+"pin-"+t.charAt(0)+o+"+"+u+".png"}function g(e,r,t){return n("Style",{id:t},n("IconStyle",n("Icon",n("href",j(e,r))))+M)}function k(e){for(var r in e)if({stroke:!0,"stroke-opacity":!0,"stroke-width":!0,fill:!0,"fill-opacity":!0}[r])return!0}function S(e){delete e.stroke,delete e["stroke-opacity"],delete e["stroke-width"],delete e.fill,delete e["fill-opacity"]}function v(e,r){var t=n("LineStyle",n("color",s(e.stroke,e["stroke-opacity"])||"ff555555")+n("width",{},e["stroke-width"]===void 0?2:e["stroke-width"])),o="";return(e.fill||e["fill-opacity"])&&(o=n("PolyStyle",n("color",{},s(e.fill,e["fill-opacity"])||"88555555"))),n("Style",{id:r},t+o)}function P(e){var r="";return e["marker-symbol"]&&(r=r+"ms"+e["marker-symbol"]),e["marker-color"]&&(r=r+"mc"+e["marker-color"].replace("#","")),e["marker-size"]&&(r=r+"ms"+e["marker-size"]),e.stroke&&(r=r+"s"+e.stroke.replace("#","")),e["stroke-width"]&&(r=r+"sw"+e["stroke-width"].toString().replace(".","")),e["stroke-opacity"]&&(r=r+"mo"+e["stroke-opacity"].toString().replace(".","")),e.fill&&(r=r+"f"+e.fill.replace("#","")),e["fill-opacity"]&&(r=r+"fo"+e["fill-opacity"].toString().replace(".","")),r}function L(e){var r=[];for(var t in e)e[t]?r.push([t,e[t]]):r.push([t,""]);return r}import{defu as x}from"defu";function h(e){return e.documentName!==void 0?n("name",e.documentName):""}function A(e){return e.documentDescription!==void 0?n("description",e.documentDescription):""}function b(e,r){return e[r.name]?n("name",c(e[r.name])):""}function D(e,r){return e[r.description]?n("description",c(e[r.description])):""}function O(e,r){return e[r.timestamp]?n("TimeStamp",n("when",c(e[r.timestamp]))):""}function z(e){return n("Data",{name:e[0]},n("value",{},c(e[1]?typeof e[1]=="string"?e[1]:JSON.stringify(e[1]):"")))}function R(e){return n("ExtendedData",{},L(e).map(z).join(""))}function m(e,r){return function(t){if(!t.properties||!a.valid(t.geometry))return"";var o=a.any(t.geometry);if(!o)return"";var u="",i="";if(e.simplestyle){var f=P(t.properties);f&&(a.isPoint(t.geometry)&&d(t.properties)?(r.indexOf(f)===-1&&(u=g(e.iconBaseUrl,t.properties,f),r.push(f)),i=n("styleUrl","#"+f),y(t.properties)):(a.isPolygon(t.geometry)||a.isLine(t.geometry))&&k(t.properties)&&(r.indexOf(f)===-1&&(u=v(t.properties,f),r.push(f)),i=n("styleUrl","#"+f),S(t.properties)))}var p={};return t.id&&(p.id=t.id.toString()),u+n("Placemark",p,b(t.properties,e)+D(t.properties,e)+R(t.properties)+O(t.properties,e)+o+i)}}function G(e,r){if(!e.type)return"";var t=[];switch(e.type){case"FeatureCollection":return e.features?e.features.map(m(r,t)).join(""):"";case"Feature":return m(r,t)(e);default:return m(r,t)({type:"Feature",geometry:e,properties:{}})}}var U={documentName:void 0,documentDescription:void 0,name:"name",description:"description",simplestyle:!1,iconBaseUrl:"https://api.tiles.mapbox.com/v3/marker/",timestamp:"timestamp"};function Z(e,r){return r=x(r,U),'<?xml version="1.0" encoding="UTF-8"?>'+n("kml",{xmlns:"http://www.opengis.net/kml/2.2"},n("Document",h(r)+A(r)+G(e,r)))}export{Z as toKML};
//# sourceMappingURL=index.mjs.map